<html>

<head>
    <meta charset='utf-8' />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="../../dist/ol/include-ol.js"></script>
    <script src="../../examples/js/common.js"></script>
    <title>Scatter Chart</title>
    <style>
        .map {
            width: 100%;
            height: calc(100vh - 20px);
        }
        
        body {
            overflow: hidden;
        }
        
        .ol-popup {
            position: absolute;
            background-color: white;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #cccccc;
            bottom: 12px;
            left: -50px;
            min-width: 280px;
        }
        
        .ol-popup:after,
        .ol-popup:before {
            top: 100%;
            border: solid transparent;
            content: " ";
            height: 0;
            width: 0;
            position: absolute;
            pointer-events: none;
        }
        
        .ol-popup:after {
            border-top-color: white;
            border-width: 10px;
            left: 48px;
            margin-left: -10px;
        }
        
        .ol-popup:before {
            border-top-color: #cccccc;
            border-width: 11px;
            left: 48px;
            margin-left: -11px;
        }
        
        .ol-popup-closer {
            text-decoration: none;
            position: absolute;
            top: 2px;
            right: 8px;
        }
        
        .ol-popup-closer:after {
            content: "âœ–";
        }
    </style>
</head>

<body>
    <div style="width: 100%;">
        <div id="divMapId" class="map">
        </div>
        <div id="popup" class="ol-popup">
            <a href="#" id="popup-closer" class="ol-popup-closer"></a>
            <div id="popup-content"></div>
        </div>
    </div>
    <script type="text/javascript" include="echarts" src="../js/include-web.js"></script>
    <script type="text/javascript">
        var data, pointFeature, addPointsSource, featureLayers, dataSource;
        var chart, div, popup = '';
        var container = document.getElementById('popup');
        var content = document.getElementById('popup-content');
        var closer = document.getElementById('popup-closer');
        var overlay = new ol.Overlay({
            element: container,
            autoPan: true,
            autoPanAnimation: {
                duration: 250,
            },
        });
        closer.onclick = function() {
            overlay.setPosition(undefined);
            closer.blur();
            return false;
        };
        var map = new ol.Map({
            target: 'divMapId',
            overlays: [overlay],
            view: new ol.View({
                center: [105.77029421156942, 21.010523871795243],
                zoom: 11.5,
                projection: 'EPSG:4326',
                multiWorld: true
            })
        });
        var vnMap = new ol.ekmap.TiledVietNamMapLayer({
            token: tokenVN
        }).addTo(map)

        //Data: https://moitruongthudo.vn/ 
        var data1 = [
            [5, 46],
            [6, 49],
            [7, 50],
            [8, 45],
            [9, 44],
            [10, 0],
            [11, 0],
            [12, 0],
            [13, 31],
            [14, 34],
            [15, 0],
            [16, 32],
            [17, 38],
            [18, 0],
            [19, 28],
            [20, 31],
            [21, 35],
            [22, 37],
            [23, 38]
        ];

        var data7 = [
            [1, 40],
            [2, 45],
            [3, 45],
            [4, 43],
            [5, 41],
            [6, 42],
            [7, 46],
            [8, 47],
            [9, 57],
            [10, 55],
            [11, 54],
            [12, 49],
            [13, 53],
            [14, 53],
            [15, 58],
            [16, 61],
            [17, 61],
            [18, 0],
            [19, 43],
            [20, 44],
            [21, 45],
            [22, 43],
            [23, 0]
        ];

        var data8 = [
            [1, 36],
            [2, 30],
            [3, 34],
            [4, 33],
            [5, 28],
            [6, 28],
            [7, 29],
            [8, 38],
            [9, 32],
            [10, 33],
            [11, 33],
            [12, 34],
            [13, 33],
            [14, 31],
            [15, 29],
            [16, 29],
            [17, 30],
            [18, 33],
            [19, 34],
            [20, 0],
            [21, 25],
            [22, 34],
            [23, 43]
        ];

        var data9 = [
            [1, 33],
            [2, 0],
            [3, 0],
            [4, 0],
            [5, 0],
            [6, 22],
            [7, 28],
            [8, 30],
            [9, 30],
            [10, 29],
            [11, 29],
            [12, 29],
            [13, 29],
            [14, 27],
            [15, 28],
            [16, 29],
            [17, 29],
            [18, 0],
            [19, 0],
            [20, 0],
            [21, 0],
            [22, 21],
            [23, 25]
        ]

        var data10 = [
            [1, 60],
            [2, 63],
            [3, 64],
            [4, 61],
            [5, 57],
            [6, 57],
            [7, 0],
            [8, 43],
            [9, 39],
            [10, 59],
            [11, 59],
            [12, 57],
            [13, 58],
            [14, 60],
            [15, 63],
            [16, 29],
            [17, 63],
            [18, 62],
            [19, 63],
            [20, 0],
            [21, 48],
            [22, 48],
            [23, 51]
        ]

        var data11 = [
            [1, 31],
            [2, 33],
            [3, 32],
            [4, 28],
            [5, 23],
            [6, 22],
            [7, 24],
            [8, 24],
            [9, 31],
            [10, 27],
            [11, 28],
            [12, 28],
            [13, 27],
            [14, 26],
            [15, 25],
            [16, 28],
            [17, 28],
            [18, 27],
            [19, 28],
            [20, 28],
            [21, 27],
            [22, 32],
            [23, 32]
        ]

        var data12 = [
            [1, 31],
            [2, 26],
            [3, 22],
            [4, 19],
            [5, 20],
            [6, 36],
            [7, 36],
            [8, 37],
            [9, 31],
            [10, 37],
            [11, 39],
            [12, 41],
            [13, 10],
            [14, 38],
            [15, 39],
            [16, 42],
            [17, 42],
            [18, 40],
            [19, 41],
            [20, 41],
            [21, 42],
            [22, 39],
            [23, 33]
        ]

        var data13 = [
            [1, 57],
            [2, 57],
            [3, 57],
            [4, 53],
            [5, 53],
            [6, 54],
            [7, 56],
            [8, 56],
            [9, 54],
            [10, 59],
            [11, 58],
            [12, 57],
            [13, 60],
            [14, 59],
            [15, 62],
            [16, 64],
            [17, 64],
            [18, 65],
            [19, 63],
            [20, 62],
            [21, 58],
            [22, 58],
            [23, 88]
        ]

        var data14 = [
            [1, 47],
            [2, 46],
            [3, 41],
            [4, 33],
            [5, 27],
            [6, 28],
            [7, 37],
            [8, 41],
            [9, 42],
            [10, 39],
            [11, 42],
            [12, 44],
            [13, 44],
            [14, 42],
            [15, 42],
            [16, 47],
            [17, 47],
            [18, 46],
            [19, 46],
            [20, 48],
            [21, 48],
            [22, 45],
            [23, 45]
        ]

        var data15 = [
            [1, 30],
            [2, 35],
            [3, 37],
            [4, 35],
            [5, 40],
            [6, 46],
            [7, 53],
            [8, 52],
            [9, 49],
            [10, 55],
            [11, 54],
            [12, 53],
            [13, 55],
            [14, 59],
            [15, 63],
            [16, 64],
            [17, 62],
            [18, 63],
            [19, 63],
            [20, 63],
            [21, 87],
            [22, 41],
            [23, 38]
        ]

        var data24 = [
            [1, 9],
            [2, 8],
            [3, 8],
            [4, 6],
            [5, 6],
            [6, 6],
            [7, 6],
            [8, 7],
            [9, 7],
            [10, 9],
            [11, 8],
            [12, 8],
            [13, 7],
            [14, 7],
            [15, 6],
            [16, 6],
            [17, 7],
            [18, 8],
            [19, 9],
            [20, 10],
            [21, 10],
            [22, 9],
            [23, 9]
        ]

        var data25 = [
            [1, 8],
            [2, 7],
            [3, 6],
            [4, 6],
            [5, 5],
            [6, 5],
            [7, 5],
            [8, 5],
            [9, 5],
            [10, 8],
            [11, 8],
            [12, 8],
            [13, 8],
            [14, 8],
            [15, 8],
            [16, 8],
            [17, 8],
            [18, 8],
            [19, 8],
            [20, 8],
            [21, 8],
            [22, 8],
            [23, 8]
        ]

        var data26 = [
            [1, 8],
            [2, 7],
            [3, 6],
            [4, 6],
            [5, 5],
            [6, 5],
            [7, 6],
            [8, 6],
            [9, 6],
            [10, 10],
            [11, 10],
            [12, 10],
            [13, 9],
            [14, 9],
            [15, 8],
            [16, 8],
            [17, 8],
            [18, 9],
            [19, 9],
            [20, 9],
            [21, 10],
            [22, 9],
            [23, 9]
        ]

        var data27 = [
            [1, 11],
            [2, 10],
            [3, 8],
            [4, 7],
            [5, 7],
            [6, 7],
            [7, 8],
            [8, 9],
            [9, 9],
            [10, 16],
            [11, 15],
            [12, 14],
            [13, 14],
            [14, 13],
            [15, 13],
            [16, 13],
            [17, 13],
            [18, 14],
            [19, 14],
            [20, 14],
            [21, 14],
            [22, 14],
            [23, 14]
        ]

        var data28 = [
            [1, 14],
            [2, 14],
            [3, 13],
            [4, 12],
            [5, 12],
            [6, 16],
            [7, 15],
            [8, 14],
            [9, 13],
            [10, 15],
            [11, 14],
            [12, 14],
            [13, 13],
            [14, 12],
            [15, 10],
            [16, 10],
            [17, 11],
            [18, 14],
            [19, 17],
            [20, 19],
            [21, 18],
            [22, 17],
            [23, 16]
        ]

        var data29 = [
            [1, 20],
            [2, 19],
            [3, 17],
            [4, 16],
            [5, 17],
            [6, 23],
            [7, 20],
            [8, 18],
            [9, 15],
            [10, 18],
            [11, 18],
            [12, 16],
            [13, 16],
            [14, 14],
            [15, 13],
            [16, 13],
            [17, 15],
            [18, 22],
            [19, 22],
            [20, 21],
            [21, 21],
            [22, 21],
            [23, 21]
        ]

        var data30 = [
            [1, 4],
            [2, 5],
            [3, 5],
            [4, 5],
            [5, 6],
            [6, 8],
            [7, 7],
            [8, 6],
            [9, 5],
            [10, 12],
            [11, 12],
            [12, 12],
            [13, 11],
            [14, 11],
            [15, 10],
            [16, 9],
            [17, 10],
            [18, 12],
            [19, 14],
            [20, 11],
            [21, 10],
            [22, 7],
            [23, 5]
        ]

        var data31 = [
            [1, 17],
            [2, 16],
            [3, 14],
            [4, 13],
            [5, 13],
            [6, 16],
            [7, 16],
            [8, 16],
            [9, 16],
            [10, 22],
            [11, 19],
            [12, 18],
            [13, 16],
            [14, 14],
            [15, 13],
            [16, 13],
            [17, 14],
            [18, 18],
            [19, 20],
            [20, 21],
            [21, 21],
            [22, 20],
            [23, 19]
        ]

        var data32 = [
            [1, 10],
            [2, 10],
            [3, 8],
            [4, 8],
            [5, 8],
            [6, 9],
            [7, 10],
            [8, 10],
            [9, 10],
            [10, 22],
            [11, 13],
            [12, 11],
            [13, 10],
            [14, 9],
            [15, 8],
            [16, 8],
            [17, 9],
            [18, 11],
            [19, 12],
            [20, 13],
            [21, 12],
            [22, 12],
            [23, 11]
        ]

        var data33 = [
            [1, 17],
            [2, 15],
            [3, 13],
            [4, 12],
            [5, 13],
            [6, 17],
            [7, 16],
            [8, 17],
            [9, 18],
            [10, 25],
            [11, 21],
            [12, 18],
            [13, 17],
            [14, 15],
            [15, 13],
            [16, 13],
            [17, 15],
            [18, 17],
            [19, 20],
            [20, 22],
            [21, 22],
            [22, 21],
            [23, 20]
        ]

        var data34 = [
            [1, 11],
            [2, 10],
            [3, 8],
            [4, 7],
            [5, 9],
            [6, 10],
            [7, 10],
            [8, 10],
            [9, 8],
            [10, 9],
            [11, 8],
            [12, 8],
            [13, 8],
            [14, 7],
            [15, 7],
            [16, 7],
            [17, 7],
            [18, 8],
            [19, 9],
            [20, 9],
            [21, 9],
            [22, 9],
            [23, 8]
        ]

        var data35 = [
            [1, 7],
            [2, 8],
            [3, 7],
            [4, 3],
            [5, 8],
            [6, 9],
            [7, 10],
            [8, 9],
            [9, 8],
            [10, 7],
            [11, 7],
            [12, 6],
            [13, 6],
            [14, 5],
            [15, 5],
            [16, 5],
            [17, 6],
            [18, 7],
            [19, 8],
            [20, 9],
            [21, 9],
            [22, 9],
            [23, 8]
        ]

        var data36 = [
            [1, 74],
            [2, 82],
            [3, 74],
            [4, 61],
            [5, 42],
            [6, 28],
            [7, 22],
            [8, 27],
            [9, 24],
            [10, 38],
            [11, 36],
            [12, 34],
            [13, 37],
            [14, 22],
            [15, 20],
            [16, 19],
            [17, 20],
            [18, 25],
            [19, 32],
            [20, 35],
            [21, 37],
            [22, 35],
            [23, 36]
        ]

        var data37 = [
            [1, 15],
            [2, 15],
            [3, 14],
            [4, 12],
            [5, 12],
            [6, 17],
            [7, 18],
            [8, 16],
            [9, 13],
            [10, 19],
            [11, 19],
            [12, 18],
            [13, 17],
            [14, 17],
            [15, 17],
            [16, 16],
            [17, 16],
            [18, 17],
            [19, 18],
            [20, 18],
            [21, 19],
            [22, 18],
            [23, 17]
        ]

        var data38 = [
            [1, 12],
            [2, 12],
            [3, 10],
            [4, 9],
            [5, 10],
            [6, 9],
            [7, 9],
            [8, 10],
            [9, 9],
            [10, 8],
            [11, 8],
            [12, 8],
            [13, 7],
            [14, 7],
            [15, 7],
            [16, 8],
            [17, 8],
            [18, 9],
            [19, 9],
            [20, 10],
            [21, 10],
            [22, 10],
            [23, 10]
        ]

        var data39 = [
            [1, 12],
            [2, 10],
            [3, 9],
            [4, 9],
            [5, 10],
            [6, 12],
            [7, 11],
            [8, 13],
            [9, 11],
            [10, 12],
            [11, 10],
            [12, 9],
            [13, 8],
            [14, 7],
            [15, 7],
            [16, 7],
            [17, 9],
            [18, 12],
            [19, 15],
            [20, 15],
            [21, 13],
            [22, 14],
            [23, 14]
        ]

        var data41 = [
            [1, 12],
            [2, 10],
            [3, 10],
            [4, 9],
            [5, 9],
            [6, 10],
            [7, 12],
            [8, 11],
            [9, 10],
            [10, 21],
            [11, 19],
            [12, 18],
            [13, 17],
            [14, 17],
            [15, 16],
            [16, 15],
            [17, 14],
            [18, 15],
            [19, 17],
            [20, 18],
            [21, 18],
            [22, 18],
            [23, 17]
        ]

        var data42 = [
            [1, 14],
            [2, 12],
            [3, 14],
            [4, 12],
            [5, 10],
            [6, 9],
            [7, 9],
            [8, 10],
            [9, 10],
            [10, 12],
            [11, 11],
            [12, 11],
            [13, 9],
            [14, 8],
            [15, 8],
            [16, 9],
            [17, 11],
            [18, 10],
            [19, 10],
            [20, 9],
            [21, 10],
            [22, 9],
            [23, 10]
        ]

        var data43 = [
            [1, 17],
            [2, 14],
            [3, 14],
            [4, 14],
            [5, 12],
            [6, 12],
            [7, 14],
            [8, 14],
            [9, 14],
            [10, 15],
            [11, 13],
            [12, 12],
            [13, 11],
            [14, 10],
            [15, 11],
            [16, 13],
            [17, 14],
            [18, 16],
            [19, 20],
            [20, 20],
            [21, 21],
            [22, 22],
            [23, 19]
        ]

        var data44 = [
            [1, 17],
            [2, 17],
            [3, 15],
            [4, 13],
            [5, 15],
            [6, 17],
            [7, 18],
            [8, 20],
            [9, 19],
            [10, 18],
            [11, 18],
            [12, 18],
            [13, 17],
            [14, 16],
            [15, 15],
            [16, 15],
            [17, 17],
            [18, 22],
            [19, 29],
            [20, 23],
            [21, 20],
            [22, 18],
            [23, 18]
        ]

        var data45 = [
            [1, 21],
            [2, 21],
            [3, 20],
            [4, 23],
            [5, 23],
            [6, 23],
            [7, 23],
            [8, 32],
            [9, 29],
            [10, 27],
            [11, 24],
            [12, 21],
            [13, 19],
            [14, 16],
            [15, 15],
            [16, 18],
            [17, 21],
            [18, 22],
            [19, 2],
            [20, 20],
            [21, 20],
            [22, 20],
            [23, 21]
        ]

        var data46 = [
            [1, 4],
            [2, 5],
            [3, 5],
            [4, 4],
            [5, 4],
            [6, 4],
            [7, 4],
            [8, 4],
            [9, 4],
            [10, 4],
            [11, 4],
            [12, 4],
            [13, 4],
            [14, 4],
            [15, 4],
            [16, 4],
            [17, 4],
            [18, 6],
            [19, 6],
            [20, 7],
            [21, 7],
            [22, 6],
            [23, 6]
        ]

        var data47 = [
            [1, 64],
            [2, 57],
            [3, 65],
            [4, 63],
            [5, 55],
            [6, 50],
            [7, 55],
            [8, 53],
            [9, 30],
            [10, 26],
            [11, 19],
            [12, 16],
            [13, 14],
            [14, 14],
            [15, 14],
            [16, 15],
            [17, 19],
            [18, 28],
            [19, 33],
            [20, 31],
            [21, 29],
            [22, 34],
            [23, 48]
        ]
        var schema = [{
            name: 'Time',
            index: 0,
            text: 'Time'
        }, {
            name: 'PM25',
            index: 2,
            text: 'PM2.5'
        }, ];

        var dataMap = {
            "1": data1,
            "7": data7,
            "8": data8,
            "9": data9,
            "10": data10,
            "11": data11,
            "12": data12,
            "13": data13,
            "14": data14,
            "15": data15,
            "24": data24,
            "25": data25,
            "26": data26,
            "27": data27,
            "28": data28,
            "29": data29,
            "30": data30,
            "31": data31,
            "32": data32,
            "33": data33,
            "34": data34,
            "35": data35,
            "36": data36,
            "37": data37,
            "38": data38,
            "39": data39,
            "41": data14,
            "42": data42,
            "43": data43,
            "44": data44,
            "45": data45,
            "46": data46,
            "47": data47
        };
        var itemStyle = {
            normal: {
                opacity: 0.8,
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowOffsetY: 0,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
            }
        };
        var option = {
            backgroundColor: '#404a59',
            color: [
                '#dd4444'
            ],
            legend: {
                y: 'top',
                data: ['1'],
                textStyle: {
                    color: '#fff',
                    fontSize: 16
                },
                selectedMode: 'single'
            },
            grid: {
                x: '10%',
                x2: 150,
                y: '18%',
                y2: '10%'
            },
            tooltip: {
                padding: 10,
                backgroundColor: '#222',
                borderColor: '#777',
                borderWidth: 1,
                formatter: function(obj) {
                    var value = obj.value;
                    return '<div style="border-bottom: 1px solid rgba(255,255,255,.3); font-size: 18px;padding-bottom: 7px;margin-bottom: 7px">' +
                        obj.name + ' ' + ' At ' + value[0] + " o'clock" +
                        '</div>' +
                        schema[1].text + 'ï¼š' + value[1] + '<br>'
                }
            },
            xAxis: {
                type: 'value',
                name: "Hour",
                nameGap: 16,
                nameTextStyle: {
                    color: '#fff',
                    fontSize: 14
                },
                max: 23,
                splitLine: {
                    show: false
                },
                axisLine: {
                    lineStyle: {
                        color: '#eee'
                    }
                }
            },
            yAxis: {
                type: 'value',
                name: "PM2.5",
                nameLocation: 'end',
                nameGap: 40,
                nameTextStyle: {
                    color: '#fff',
                    fontSize: 16
                },
                axisLine: {
                    lineStyle: {
                        color: '#eee'
                    }
                },
                splitLine: {
                    show: false
                }
            },
            visualMap: [{
                left: 'right',
                top: '30%',
                dimension: 2,
                min: 0,
                max: 23,
                itemWidth: 40,
                itemHeight: 80,
                calculable: true,
                precision: 0.1,
                text: ["round_size PM2.5"],
                textGap: 40,
                textStyle: {
                    color: '#fff'
                },
                inRange: {
                    symbolSize: [10, 30]
                },
                outOfRange: {
                    symbolSize: [10, 30],
                    color: ['rgba(255,255,255,.2)']
                },
                controller: {
                    inRange: {
                        color: ['#c23531']
                    },
                    outOfRange: {
                        color: ['#444']
                    }
                }
            }],
            series: [{
                name: 'åŒ—äº¬å¸‚',
                type: 'scatter',
                itemStyle: itemStyle,
                data: data1
            }]
        };
        div = document.createElement('div');
        chart = echarts.init(div, '', {
            width: 450,
            height: 350
        });

        chart.setOption(option);
        query();

        function iconStyleFunc() {
            var zIndex = 1;
            var iconStyle = [new ol.style.Style({
                image: new ol.style.Icon(({
                    anchor: [0.5, 0.5],
                    anchorXUnits: 'fraction',
                    anchorYUnits: 'pixels',
                    scale: 0.1,
                    src: './img/marker-icon-red.png',
                    zIndex: zIndex
                })),
                zIndex: zIndex
            })];
            return iconStyle;
        }

        function query() {
            $.get("https://demo.ekgis.vn/ekmapsdks/data/echarts_scatter.json", function(response) {
                dataSource = new ol.source.Vector({
                    features: new ol.format.GeoJSON().readFeatures(response),
                });
                featureLayers = new ol.layer.Vector({
                    source: dataSource,
                    style: iconStyleFunc()
                });
                map.addLayer(featureLayers)
            })
            map.on('click', function(e) {
                var feature = map.forEachFeatureAtPixel(e.pixel, function(feature) {
                    return feature;
                });
                if (feature) {
                    var city = feature.getProperties().NAME
                    var color = feature.getProperties().color;
                    var legend = feature.getProperties().aqiText;
                    var id = feature.getProperties().id;
                    var coordinate = e.coordinate;
                    chart.setOption({
                        color: [
                            color
                        ],
                        legend: {
                            data: [id]
                        },
                        series: [{
                            name: name,
                            type: 'scatter',
                            itemStyle: itemStyle,
                            data: dataMap[id]
                        }]
                    });
                    content.append(div);
                    overlay.setPosition(coordinate);
                }
            });
        }
    </script>
</body>

</html>